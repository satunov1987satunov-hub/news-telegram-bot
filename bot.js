import dotenv from "dotenv";
import express from "express";
import { Telegraf } from "telegraf";

dotenv.config();

const token = process.env.TELEGRAM_BOT_TOKEN;
if (!token) {
  console.error("âŒ TELEGRAM_BOT_TOKEN Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½!");
  process.exit(1);
}

const bot = new Telegraf(token);

// /start
bot.start((ctx) => {
  ctx.reply(
    "ÐŸÑ€Ð¸Ð²ÐµÑ‚! Ð¯ News SUA Bot ðŸ¤–\n\n" +
    "ÐšÐ¾Ð¼Ð°Ð½Ð´Ñ‹:\n" +
    "ðŸ‘‰ /news â€“ ÑÐ²ÐµÐ¶Ð°Ñ Ð½Ð¾Ð²Ð¾ÑÑ‚ÑŒ\n" +
    "ðŸ‘‰ /image â€“ Ð¿Ñ€Ð¾Ð¼Ñ‚ Ð´Ð»Ñ ÐºÐ°Ñ€Ñ‚Ð¸Ð½ÐºÐ¸\n" +
    "ðŸ‘‰ /video â€“ Ð¿Ñ€Ð¾Ð¼Ñ‚ Ð´Ð»Ñ Ð²Ð¸Ð´ÐµÐ¾ (70 ÑÐµÐºÑƒÐ½Ð´)\n" +
    "ðŸ‘‰ Ð½Ð°Ð¿Ð¸ÑˆÐ¸: 'Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑˆÑŒ?'"
  );
});

// ÐŸÑ€Ð¸Ð²ÐµÑ‚
bot.hears(/Ð¿Ñ€Ð¸Ð²ÐµÑ‚/i, (ctx) => {
  ctx.reply("ÐŸÑ€Ð¸Ð²ÐµÑ‚! Ð¯ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÑŽ ðŸ¤–");
});

// Ð Ð°Ð±Ð¾Ñ‚Ð°ÐµÑˆÑŒ?
bot.hears(/Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑˆÑŒ/i, (ctx) => {
  ctx.reply("Ð”Ð°, Ñ Ð·Ð´ÐµÑÑŒ, Ð²ÑÑ‘ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ ðŸ”¥");
});

// ðŸŸ¦ /news â€” Ñ‚ÐµÑÑ‚Ð¾Ð²Ð°Ñ Ð½Ð¾Ð²Ð¾ÑÑ‚ÑŒ
bot.command("news", (ctx) => {
  ctx.reply(
    "ðŸŸ¦ ÐÐ¾Ð²Ð¾ÑÑ‚ÑŒ:\n" +
    "ÐÐ½Ð°Ð»Ð¸Ñ‚Ð¸ÐºÐ¸ ÑÐ¿Ð¾Ñ€ÑÑ‚ Ð¾ Ð²Ð½ÐµÑˆÐ½ÐµÐ¹ Ð¿Ð¾Ð»Ð¸Ñ‚Ð¸ÐºÐµ Ð¸ ÑÐºÐ¾Ð½Ð¾Ð¼Ð¸Ñ‡ÐµÑÐºÐ¸Ñ… Ñ‚Ñ€ÑƒÐ´Ð½Ð¾ÑÑ‚ÑÑ…. " +
    "Ð¡Ð¸Ñ‚ÑƒÐ°Ñ†Ð¸Ñ Ð¾ÑÑ‚Ð°Ñ‘Ñ‚ÑÑ Ð½ÐµÑÑ‚Ð°Ð±Ð¸Ð»ÑŒÐ½Ð¾Ð¹. ÐÐ¾Ð²Ñ‹Ðµ Ð·Ð°ÑÐ²Ð»ÐµÐ½Ð¸Ñ Ð¼Ð¾Ð³ÑƒÑ‚ Ð¸Ð·Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ð²ÑÑ‘."
  );
});

// ðŸŸ¨ /image â€” Ð¿Ñ€Ð¾Ð¼Ñ‚ Ð´Ð»Ñ ÐºÐ°Ñ€Ñ‚Ð¸Ð½ÐºÐ¸
bot.command("image", (ctx) => {
  ctx.reply(
    "ðŸ–¼ ÐÐ°Ð¿Ð¸ÑˆÐ¸ Ñ‚ÐµÐ¼Ñƒ ÐºÐ°Ñ€Ñ‚Ð¸Ð½ÐºÐ¸.\nÐŸÑ€Ð¸Ð¼ÐµÑ€:\n" +
    `"image Ñ‚Ñ€Ð°Ð¼Ð¿ Ð²Ñ‹ÑÑ‚ÑƒÐ¿Ð°ÐµÑ‚ 9:16"`
  );
});

// ðŸŸ¥ /video â€” Ð¿Ñ€Ð¾Ð¼Ñ‚ Ð½Ð° 70 ÑÐµÐºÑƒÐ½Ð´
bot.command("video", (ctx) => {
  ctx.reply(
`ðŸŽ¬ ÐŸÑ€Ð¾Ð¼Ñ‚ Ð´Ð»Ñ Ð²Ð¸Ð´ÐµÐ¾ (70 ÑÐµÐºÑƒÐ½Ð´):

Ð¡Ð¾Ð·Ð´Ð°Ð¹ Ð²Ð¸Ð´ÐµÐ¾ Ð² ÑÑ‚Ð¸Ð»Ðµ Ð½Ð¾Ð²Ð¾ÑÑ‚Ð½Ð¾Ð³Ð¾ ÐºÐ°Ð½Ð°Ð»Ð°, Ð´Ð»Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ 70 ÑÐµÐºÑƒÐ½Ð´, ÑƒÐ¼ÐµÑ€ÐµÐ½Ð½Ð°Ñ Ñ€ÐµÑ‡ÑŒ Ð´Ð¸ÐºÑ‚Ð¾Ñ€Ð°.
Ð¢ÐµÐ¼Ð°: Ð½Ð¾Ð²Ñ‹Ðµ Ð¿Ð¾Ð»Ð¸Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ Ð·Ð°ÑÐ²Ð»ÐµÐ½Ð¸Ñ, Ð°Ð½Ð°Ð»Ð¸Ñ‚Ð¸ÐºÐ¸ ÑÐ¿Ð¾Ñ€ÑÑ‚ Ð¾ Ð²Ð½ÐµÑˆÐ½ÐµÐ¹ Ð¿Ð¾Ð»Ð¸Ñ‚Ð¸ÐºÐµ Ð¸ Ð²Ð½ÑƒÑ‚Ñ€ÐµÐ½Ð½Ð¸Ñ… ÑÐºÐ¾Ð½Ð¾Ð¼Ð¸Ñ‡ÐµÑÐºÐ¸Ñ… Ñ‚Ñ€ÑƒÐ´Ð½Ð¾ÑÑ‚ÑÑ….
Ð¡Ð¸Ñ‚ÑƒÐ°Ñ†Ð¸Ñ Ð¾ÑÑ‚Ð°Ñ‘Ñ‚ÑÑ Ð½ÐµÑÑ‚Ð°Ð±Ð¸Ð»ÑŒÐ½Ð¾Ð¹. ÐÐ¾Ð²Ñ‹Ðµ Ð·Ð°ÑÐ²Ð»ÐµÐ½Ð¸Ñ Ð¼Ð¾Ð³ÑƒÑ‚ Ð¸Ð·Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ ÐµÑ‘ Ð² Ð±Ð»Ð¸Ð¶Ð°Ð¹ÑˆÐ¸Ðµ Ð´Ð½Ð¸.

Ð Ð°Ð·Ð±ÐµÐ¹ Ð½Ð° ÐºÐ°Ð´Ñ€Ñ‹ Ð¿Ð¾ 6â€“7 ÑÐµÐºÑƒÐ½Ð´.
Ð ÐµÐ°Ð»Ð¸ÑÑ‚Ð¸Ñ‡Ð½Ñ‹Ð¹ ÑÑ‚Ð¸Ð»ÑŒ, Ð±ÐµÐ· Ð¼ÑƒÐ·Ñ‹ÐºÐ¸, Ð·Ð²ÑƒÐº Ð°Ñ‚Ð¼Ð¾ÑÑ„ÐµÑ€Ñ‹ Ð½Ð¾Ð²Ð¾ÑÑ‚ÐµÐ¹.
Ð¡Ð´ÐµÐ»Ð°Ð¹ 10â€“12 ÑÑ†ÐµÐ½ Ð´Ð»Ñ Ð¿Ð¾Ð»Ð½Ð¾Ð³Ð¾ Ð¿Ð¾ÐºÑ€Ñ‹Ñ‚Ð¸Ñ 70 ÑÐµÐºÑƒÐ½Ð´.`);
});

// Fallback
bot.on("text", (ctx) => {
  ctx.reply("Ð¯ Ñ‚ÐµÐ±Ñ Ð¿Ð¾Ð½ÑÐ». Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹: /news, /image, /video, Ð¿Ñ€Ð¸Ð²ÐµÑ‚, Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÑŽ.");
});

// Express Ð´Ð»Ñ Render
const app = express();
const PORT = process.env.PORT || 10000;

app.get("/", (req, res) => {
  res.send("Bot is running!");
});

(async () => {
  try {
    await bot.telegram.deleteWebhook();
    console.log("Webhook ÑƒÐ´Ð°Ð»Ñ‘Ð½, Ð²ÐºÐ»ÑŽÑ‡Ð°ÑŽ polling...");
    await bot.launch();
    console.log("ðŸ¤– Bot started");
  } catch (e) {
    console.error("ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð¿ÑƒÑÐºÐ°:", e);
  }
})();

app.listen(PORT, () => {
  console.log(`Server started on port ${PORT}`);
});
