import dotenv from "dotenv";
import express from "express";
import { Telegraf } from "telegraf";

dotenv.config();

// Ð‘ÐµÑ€Ñ‘Ð¼ Ñ‚Ð¾ÐºÐµÐ½ Ð±Ð¾Ñ‚Ð° Ð¸Ð· Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ð¾Ð¹ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ
const token = process.env.TELEGRAM_BOT_TOKEN;

if (!token) {
  console.error("âŒ TELEGRAM_BOT_TOKEN Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½!");
  process.exit(1);
}

// Ð¡Ð¾Ð·Ð´Ð°Ñ‘Ð¼ Ð±Ð¾Ñ‚Ð°
const bot = new Telegraf(token);

// /start
bot.start((ctx) => {
  ctx.reply(
    "ÐŸÑ€Ð¸Ð²ÐµÑ‚! Ð¯ News SUA Bot ðŸ‘‹\n\n" +
      "ÐšÐ¾Ð¼Ð°Ð½Ð´Ñ‹:\n" +
      " /news  â€“ Ð¿Ñ€Ð¸Ð¼ÐµÑ€ ÐºÐ¾Ñ€Ð¾Ñ‚ÐºÐ¾Ð¹ Ð½Ð¾Ð²Ð¾ÑÑ‚Ð¸\n" +
      " /image â€“ Ð¿Ñ€Ð¸Ð¼ÐµÑ€ Ð¿Ñ€Ð¾Ð¼Ñ‚Ð° Ð´Ð»Ñ ÐºÐ°Ñ€Ñ‚Ð¸Ð½ÐºÐ¸\n" +
      " /video â€“ Ð¿Ñ€Ð¸Ð¼ÐµÑ€ Ð¿Ñ€Ð¾Ð¼Ñ‚Ð° Ð´Ð»Ñ Ð²Ð¸Ð´ÐµÐ¾ (70 ÑÐµÐº, 16:9)\n\n" +
      "Ð¢Ð°ÐºÐ¶Ðµ Ð¼Ð¾Ð¶ÐµÑˆÑŒ Ð½Ð°Ð¿Ð¸ÑÐ°Ñ‚ÑŒ: Â«Ð¿Ñ€Ð¸Ð²ÐµÑ‚Â» Ð¸Ð»Ð¸ Â«Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑˆÑŒ?Â» ðŸ™‚"
  );
});

// ÐŸÑ€Ð¸Ð²ÐµÑ‚
bot.hears(/Ð¿Ñ€Ð¸Ð²ÐµÑ‚/i, (ctx) => {
  ctx.reply("ÐŸÑ€Ð¸Ð²ÐµÑ‚! Ð¯ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÑŽ ðŸ¤–");
});

// Ð Ð°Ð±Ð¾Ñ‚Ð°ÐµÑˆÑŒ?
bot.hears(/Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑˆÑŒ/i, (ctx) => {
  ctx.reply("Ð”Ð°, Ñ Ð·Ð´ÐµÑÑŒ, Ð²ÑÑ‘ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ ðŸ’¡");
});

// /news â€” Ñ‚ÐµÑÑ‚Ð¾Ð²Ð°Ñ Ð½Ð¾Ð²Ð¾ÑÑ‚ÑŒ
bot.command("news", (ctx) => {
  ctx.reply(
    "ðŸ“° ÐÐ¾Ð²Ð¾ÑÑ‚ÑŒ:\n" +
      "ÐÐ½Ð°Ð»Ð¸Ñ‚Ð¸ÐºÐ¸ ÑÐ¿Ð¾Ñ€ÑÑ‚ Ð¾ Ð²Ð½ÐµÑˆÐ½ÐµÐ¹ Ð¿Ð¾Ð»Ð¸Ñ‚Ð¸ÐºÐµ Ð¸ Ð²Ð½ÑƒÑ‚Ñ€ÐµÐ½Ð½Ð¸Ñ… ÑÐºÐ¾Ð½Ð¾Ð¼Ð¸Ñ‡ÐµÑÐºÐ¸Ñ… Ñ‚Ñ€ÑƒÐ´Ð½Ð¾ÑÑ‚ÑÑ…. " +
      "Ð¡Ð¸Ñ‚ÑƒÐ°Ñ†Ð¸Ñ Ð¾ÑÑ‚Ð°Ñ‘Ñ‚ÑÑ Ð½ÐµÑÑ‚Ð°Ð±Ð¸Ð»ÑŒÐ½Ð¾Ð¹. ÐÐ¾Ð²Ñ‹Ðµ Ð·Ð°ÑÐ²Ð»ÐµÐ½Ð¸Ñ Ð¼Ð¾Ð³ÑƒÑ‚ Ð¸Ð·Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ð²ÑÑ‘ Ð² Ð±Ð»Ð¸Ð¶Ð°Ð¹ÑˆÐ¸Ðµ Ð´Ð½Ð¸."
  );
});

// /image â€” Ð¿Ñ€Ð¾Ð¼Ñ‚ Ð´Ð»Ñ ÐºÐ°Ñ€Ñ‚Ð¸Ð½ÐºÐ¸
bot.command("image", (ctx) => {
  ctx.reply(
    "ðŸ–¼ ÐŸÑ€Ð¸Ð¼ÐµÑ€ Ð¿Ñ€Ð¾Ð¼Ñ‚Ð° Ð´Ð»Ñ ÐºÐ°Ñ€Ñ‚Ð¸Ð½ÐºÐ¸:\n\n" +
      "Â«cinematic ultra-realistic 9:16, Ð½Ð¾Ð²Ð¾ÑÑ‚Ð½Ð¾Ð¹ ÐºÐ°Ð´Ñ€, ÐºÑ€ÑƒÐ¿Ð½Ñ‹Ð¹ Ð¿Ð»Ð°Ð½ ÑÐ¿Ð¸ÐºÐµÑ€Ð° Ñƒ Ð¼Ð¸ÐºÑ€Ð¾Ñ„Ð¾Ð½Ð°, " +
      "Ñ„Ð¾Ð½ â€” Ñ€Ð°Ð·Ð¼Ñ‹Ñ‚Ð°Ñ ÑÑ‚ÑƒÐ´Ð¸Ñ Ð½Ð¾Ð²Ð¾ÑÑ‚ÐµÐ¹, Ð´Ñ€Ð°Ð¼Ð°Ñ‚Ð¸Ñ‡Ð½Ñ‹Ð¹ ÑÐ²ÐµÑ‚, Ð²Ñ‹ÑÐ¾ÐºÐ¸Ð¹ ÑƒÑ€Ð¾Ð²ÐµÐ½ÑŒ Ð´ÐµÑ‚Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ð¸Â»\n\n" +
      "ÐœÐ¾Ð¶ÐµÑˆÑŒ Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð·Ð°Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ñ‚ÐµÐ¼Ñƒ Ð½Ð° ÑÐ²Ð¾ÑŽ ðŸ˜‰"
  );
});

// /video â€” Ð¿Ñ€Ð¾Ð¼Ñ‚ Ð½Ð° 70 ÑÐµÐºÑƒÐ½Ð´, Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚ 16:9
bot.command("video", (ctx) => {
  ctx.reply(
    "ðŸŽ¥ ÐŸÑ€Ð¸Ð¼ÐµÑ€ Ð¿Ñ€Ð¾Ð¼Ñ‚Ð° Ð´Ð»Ñ Ð²Ð¸Ð´ÐµÐ¾ (70 ÑÐµÐºÑƒÐ½Ð´, Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚ 16:9):\n\n" +
      "Â«Ð¡Ð¾Ð·Ð´Ð°Ð¹ Ð½Ð¾Ð²Ð¾ÑÑ‚Ð½Ð¾Ðµ Ð²Ð¸Ð´ÐµÐ¾ Ð² Ð³Ð¾Ñ€Ð¸Ð·Ð¾Ð½Ñ‚Ð°Ð»ÑŒÐ½Ð¾Ð¼ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ðµ 16:9 (YouTube). " +
      "Ð”Ð»Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ Ð¾ÐºÐ¾Ð»Ð¾ 70 ÑÐµÐºÑƒÐ½Ð´, ÑƒÐ¼ÐµÑ€ÐµÐ½Ð½Ð°Ñ Ñ€ÐµÑ‡ÑŒ Ð´Ð¸ÐºÑ‚Ð¾Ñ€Ð°.\n\n" +
      "Ð¢ÐµÐ¼Ð°: Ð½Ð¾Ð²Ñ‹Ðµ Ð¿Ð¾Ð»Ð¸Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ Ð·Ð°ÑÐ²Ð»ÐµÐ½Ð¸Ñ, Ð°Ð½Ð°Ð»Ð¸Ñ‚Ð¸ÐºÐ¸ ÑÐ¿Ð¾Ñ€ÑÑ‚ Ð¾ Ð²Ð½ÐµÑˆÐ½ÐµÐ¹ Ð¿Ð¾Ð»Ð¸Ñ‚Ð¸ÐºÐµ " +
      "Ð¸ Ð²Ð½ÑƒÑ‚Ñ€ÐµÐ½Ð½Ð¸Ñ… ÑÐºÐ¾Ð½Ð¾Ð¼Ð¸Ñ‡ÐµÑÐºÐ¸Ñ… Ñ‚Ñ€ÑƒÐ´Ð½Ð¾ÑÑ‚ÑÑ…. Ð¡Ð¸Ñ‚ÑƒÐ°Ñ†Ð¸Ñ Ð¾ÑÑ‚Ð°Ñ‘Ñ‚ÑÑ Ð½ÐµÑÑ‚Ð°Ð±Ð¸Ð»ÑŒÐ½Ð¾Ð¹, " +
      "Ð½Ð¾Ð²Ñ‹Ðµ Ð·Ð°ÑÐ²Ð»ÐµÐ½Ð¸Ñ Ð¼Ð¾Ð³ÑƒÑ‚ Ð¸Ð·Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ ÐµÑ‘ Ð² Ð±Ð»Ð¸Ð¶Ð°Ð¹ÑˆÐ¸Ðµ Ð´Ð½Ð¸.\n\n" +
      "Ð Ð°Ð·Ð±ÐµÐ¹ Ñ€Ð¾Ð»Ð¸Ðº Ð½Ð° 10â€“12 ÑÑ†ÐµÐ½ Ð¿Ð¾ 6â€“7 ÑÐµÐºÑƒÐ½Ð´. ÐšÐ°Ð¶Ð´Ð°Ñ ÑÑ†ÐµÐ½Ð° Ð² Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ðµ 16:9: " +
      "ÐºÐ°Ð´Ñ€Ñ‹ ÑÑ‚ÑƒÐ´Ð¸Ð¸ Ð½Ð¾Ð²Ð¾ÑÑ‚ÐµÐ¹, ÐºÑ€ÑƒÐ¿Ð½Ñ‹Ðµ Ð¿Ð»Ð°Ð½Ñ‹ Ð²ÐµÐ´ÑƒÑ‰ÐµÐ³Ð¾, ÑƒÐ»Ð¸Ñ‡Ð½Ñ‹Ðµ Ñ€ÐµÐ¿Ð¾Ñ€Ñ‚Ð°Ð¶Ð¸, Ð¼Ð¸Ñ‚Ð¸Ð½Ð³Ð¸, " +
      "Ð·Ð´Ð°Ð½Ð¸Ñ Ð²Ð»Ð°ÑÑ‚Ð¸, Ð³Ñ€Ð°Ñ„Ð¸ÐºÐ¸ Ð¸ Ð·Ð°Ð³Ð¾Ð»Ð¾Ð²ÐºÐ¸ Ð½Ð° ÑÐºÑ€Ð°Ð½Ðµ. Ð ÐµÐ°Ð»Ð¸ÑÑ‚Ð¸Ñ‡Ð½Ñ‹Ð¹ ÑÑ‚Ð¸Ð»ÑŒ, Ð±ÐµÐ· Ð¼ÑƒÐ·Ñ‹ÐºÐ¸, " +
      "Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð°Ñ‚Ð¼Ð¾ÑÑ„ÐµÑ€Ð½Ñ‹Ðµ Ð·Ð²ÑƒÐºÐ¸ ÑÑ‚ÑƒÐ´Ð¸Ð¸ Ð¸ ÑƒÐ»Ð¸Ñ†Ñ‹.Â»"
  );
});

// Fallback â€” ÐµÑÐ»Ð¸ Ñ‚ÐµÐºÑÑ‚ Ð½Ðµ Ð¿Ð¾Ð´Ð¾ÑˆÑ‘Ð» Ð½Ð¸ Ð¿Ð¾Ð´ Ð¾Ð´Ð½Ñƒ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñƒ
bot.on("text", (ctx) => {
  ctx.reply(
    "Ð¯ Ñ‚ÐµÐ±Ñ Ð¿Ð¾Ð½ÑÐ». Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹:\n" +
      " /news  â€“ ÐºÐ¾Ñ€Ð¾Ñ‚ÐºÐ°Ñ Ð½Ð¾Ð²Ð¾ÑÑ‚ÑŒ\n" +
      " /image â€“ Ð¿Ñ€Ð¾Ð¼Ñ‚ Ð´Ð»Ñ ÐºÐ°Ñ€Ñ‚Ð¸Ð½ÐºÐ¸\n" +
      " /video â€“ Ð¿Ñ€Ð¾Ð¼Ñ‚ Ð´Ð»Ñ Ð²Ð¸Ð´ÐµÐ¾ (70 ÑÐµÐº, 16:9)\n\n" +
      "Ð˜Ð»Ð¸ Ð½Ð°Ð¿Ð¸ÑˆÐ¸: Â«Ð¿Ñ€Ð¸Ð²ÐµÑ‚Â» / Â«Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑˆÑŒ?Â» ðŸ™‚"
  );
});

// Express Ð´Ð»Ñ Render
const app = express();
const PORT = process.env.PORT || 10000;

app.get("/", (req, res) => {
  res.send("Bot is running!");
});

// Ð—Ð°Ð¿ÑƒÑÐºÐ°ÐµÐ¼ Ð±Ð¾Ñ‚Ð° Ð² Ñ€ÐµÐ¶Ð¸Ð¼Ðµ polling
(async () => {
  try {
    await bot.telegram.deleteWebhook();
    console.log("Webhook ÑƒÐ´Ð°Ð»Ñ‘Ð½, Ð²ÐºÐ»ÑŽÑ‡Ð°ÑŽ polling...");
    await bot.launch();
    console.log("âœ… Bot started");
  } catch (e) {
    console.error("ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð¿ÑƒÑÐºÐ°:", e);
  }
})();

// Ð¡Ð»ÑƒÑˆÐ°ÐµÐ¼ Ð¿Ð¾Ñ€Ñ‚ Ð´Ð»Ñ Render
app.listen(PORT, () => {
  console.log(`Server started on port ${PORT}`);
});
